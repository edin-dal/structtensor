mlir-opt MTTKRP_I.mlir --pass-pipeline="builtin.module(func.func(affine-super-vectorize{virtual-vector-size=16},affine-expand-index-ops),convert-vector-to-llvm{enable-x86vector},loop-invariant-code-motion,canonicalize,cse,func.func(affine-loop-unroll,cse,canonicalize,loop-invariant-code-motion),lower-affine,finalize-memref-to-llvm,sccp,loop-invariant-code-motion,cse,canonicalize,convert-scf-to-cf,convert-func-to-llvm,convert-cf-to-llvm,cse,canonicalize,reconcile-unrealized-casts,canonicalize,cse)" | mlir-translate --mlir-to-llvmir | llc --enable-unsafe-fp-math -O3 --mcpu=native -filetype=asm -o o.s && c++ -std=c99 o.s utils.o -g -pthread -mtune=native -Wno-narrowing -mavx2 -ffast-math -ftree-vectorize -o MTTKRP_I -O3

# new pass
mlir-opt MTTKRP_I.mlir --pass-pipeline="builtin.module(canonicalize,cse,func.func(affine-loop-invariant-code-motion,affine-parallelize,affine-simplify-structures,canonicalize,cse,affine-super-vectorize{virtual-vector-size=64 vectorize-reductions}),lower-affine,scf-parallel-loop-tiling,lower-affine,loop-invariant-code-motion,cse,canonicalize,convert-vector-to-llvm{reassociate-fp-reductions enable-x86vector},cse,canonicalize,finalize-memref-to-llvm,loop-invariant-code-motion,cse,canonicalize,convert-vector-to-scf,lower-affine,loop-invariant-code-motion,cse,canonicalize,convert-vector-to-llvm,finalize-memref-to-llvm,loop-invariant-code-motion,cse,canonicalize,convert-arith-to-llvm,cse,canonicalize,convert-scf-to-cf,canonicalize,cse,convert-func-to-llvm,convert-cf-to-llvm,cse,canonicalize)" | mlir-translate --mlir-to-llvmir | llc --enable-unsafe-fp-math -O3 --mcpu=native -filetype=asm -o o.s && c++ -std=c99 o.s utils.o -g -pthread -mtune=native -Wno-narrowing -mavx2 -ffast-math -ftree-vectorize -o MTTKRP_I -O3


clang -c utils.c -o utils.o -O3 -fPIE